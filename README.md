<div align="center">
   <h3 align="center">Structured Gaussian Splatting Compression Codec</h3>
   <br />

  <p align="center">
   <img src="imgs/gscodec.svg">
    <br />
    <br />
  </p>
</div>

The SGS code implementation is available in this repository. This repository is mainly based on the official authors implementation associated with the paper "3D Gaussian Splatting for Real-Time Radiance Field Rendering" and the paper "Compact 3D Scene Representation via Self-Organizing Gaussian Grids".

## Qualitative results

<p align="center">
  <i>Visual comparison across scenes. Columns: GT (reference), baseline 3DGS / Scaffold-GS, and our codec applied to each baseline. 
  Values under each image show PSNR (dB) and model size (MB).</i>
</p>

<table>
  <thead>
    <tr>
      <th align="left">Scene</th>
      <th>GT</th>
      <th>3DGS</th>
      <th>Ours w/ 3DGS</th>
      <th>Scaffold-GS</th>
      <th>Ours w/ Scaffold-GS</th>
    </tr>
  </thead>
  <tbody>
    <!-- truck -->
    <tr>
      <td><b>truck</b></td>
      <td>
        <img src="imgs/truck/reference.png" width="220" alt="GT"><br/>
        –
      </td>
      <td>
        <img src="imgs/truck/3DGS.png" width="220" alt="3DGS"><br/>
        25.82 dB<br/>395.0 MB
      </td>
      <td>
        <img src="imgs/truck/ours3DGS.png" width="220" alt="ours w/ 3DGS"><br/>
        25.45 dB<br/>19.1 MB
      </td>
      <td>
        <img src="imgs/truck/scaffold.png" width="220" alt="Scaffold-GS"><br/>
        25.91 dB<br/>97.6 MB
      </td>
      <td>
        <img src="imgs/truck/oursscaffold.png" width="220" alt="ours w/ Scaffold-GS"><br/>
        25.70 dB<br/>10.9 MB
      </td>
    </tr>
    <tr>
      <td><b>truck</b></td>
      <td>
        <img src="imgs/truck/reference.png" width="220" alt="GT"><br/>
        –
      </td>
      <td>
        <img src="imgs/truck/3DGS.png" width="220" alt="3DGS"><br/>
        25.82 dB<br/>395.0 MB
      </td>
      <td>
        <img src="imgs/truck/ours3DGS.png" width="220" alt="ours w/ 3DGS"><br/>
        25.45 dB<br/>19.1 MB
      </td>
      <td>
        <img src="imgs/truck/scaffold.png" width="220" alt="Scaffold-GS"><br/>
        25.91 dB<br/>97.6 MB
      </td>
      <td>
        <img src="imgs/truck/oursscaffold.png" width="220" alt="ours w/ Scaffold-GS"><br/>
        25.70 dB<br/>10.9 MB
      </td>
    </tr>
  </tbody>
</table>

## Cloning the Repository

The repository contains submodules, thus please check it out with

```shell
# SSH
git clone git@github.com:pedrogcmartin/SGS.git --recursive
```

or

```shell
# HTTPS
git clone https://github.com/pedrogcmartin/SGS.git --recursive
```

## Python Environment

The code is using a few additional Python packages on top of graphdeco-inria/gaussian-splatting. We provide an extended environment.yml:

Installation with [micromamba](https://mamba.readthedocs.io/en/latest/installation/micromamba-installation.html):

```shell
micromamba env create --file environment.yml --channel-priority flexible -y
micromamba activate sgs
```


## JPEG XL Installation

The codec makes use of JPEG XL encoder and decoder. For installation use the [jpeg-xl](https://gitlab.com/wg1/jpeg-xl) reference software.

## Running

Download a dataset, e.g. [T&T](https://repo-sam.inria.fr/fungraph/3d-gaussian-splatting/datasets/input/tandt_db.zip).

The codec supports both 3DGS-based and Scaffold-GS-based models.

To encode and decode a GS file generated by a 3DGS-based model use the following commands:

```shell
python encoder_3dgs.py --dataset tandt --scene truck --exp png_quant_sh_ours_lossless_3dgs --q 100 --e 3 --block_size 16
```
```shell
python decoder_3dgs.py --dataset tandt --scene truck --exp png_quant_sh_ours_lossless_3dgs
```

To encode and decode a GS file generated by a Scaffold-GS-based model use the following commands:

```shell
python encoder_scaffold.py --dataset tandt --scene truck --exp png_quant_sh_ours_lossless_scaffold --q 100 --e 3 --block_size 16
```
```shell
python decoder_scaffold.py --dataset tandt --scene truck --exp png_quant_sh_ours_lossless_scaffold
```

where the JPEG XL settings are controlled by the quality level (`--q`, from -inf to 100, being 100 mathematically lossless) and the effort level (`--e`, from 1 to 11) and the BB sorting block size can be adjusted using --block_size.
